name: Simple Android Build

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # ä¿ç•™æ‰‹åŠ¨è§¦å‘

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4

      # æ­¥éª¤2ï¼šè®¾ç½®Javaç¯å¢ƒ
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: 17

      # æ­¥éª¤3ï¼šè®¾ç½®Gradle
      - name: Set up Gradle
        uses: gradle/actions/setup-gradle@v4

      # æ­¥éª¤4ï¼šæ„å»ºDebugç‰ˆæœ¬ï¼ˆæ— éœ€ç­¾åï¼‰
      - name: Build Debug APK
        run: |
          chmod +x gradlew
          ./gradlew assembleAppDebug --build-cache --parallel --daemon --warning-mode all

      # æ­¥éª¤5ï¼šæ•´ç†è¾“å‡ºæ–‡ä»¶
      - name: Organize Output Files
        run: |
          mkdir -p ${{ github.workspace }}/apk/
          # å¤åˆ¶æ‰€æœ‰APKæ–‡ä»¶åˆ°ç»Ÿä¸€ç›®å½•
          find ${{ github.workspace }}/app/build/outputs/apk/ -name "*.apk" -exec cp {} ${{ github.workspace }}/apk/ \;
          echo "æ„å»ºå®Œæˆçš„APKæ–‡ä»¶ï¼š"
          ls -la ${{ github.workspace }}/apk/

      # æ­¥éª¤6ï¼šä¸Šä¼ APKä½œä¸ºåˆ¶å“
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-apks
          path: ${{ github.workspace }}/apk/*.apk
          retention-days: 7  # ä¿ç•™7å¤©

      # æ­¥éª¤7ï¼šæ˜¾ç¤ºæ„å»ºä¿¡æ¯
      - name: Display Build Info
        run: |
          echo "ğŸ‰ æ„å»ºæˆåŠŸå®Œæˆï¼"
          echo "ğŸ“± APKæ–‡ä»¶å·²ä¸Šä¼ åˆ°å·¥ä½œæµåˆ¶å“"
          echo "ğŸ‘‡ åœ¨Actionsé¡µé¢ç‚¹å‡»å½“å‰è¿è¡Œçš„å·¥ä½œæµï¼Œå³å¯ä¸‹è½½APKæ–‡ä»¶"
