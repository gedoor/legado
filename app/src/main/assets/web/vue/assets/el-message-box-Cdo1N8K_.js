import{k as b,y as D,u as w,x as L,I as C,a5 as y,ae as v}from"./vendor-DyjdUqFg.js";import{A as B}from"./index-D7Z3b_yE.js";const F=b("book",{state:()=>({connectStatus:"正在连接后端服务器……",connectType:"",newConnect:!0,searchBooks:[],shelf:[],catalog:[],readingBook:{index:0,chapterPos:0},popCataVisible:!1,contentLoading:!0,showContent:!1,config:{theme:0,font:0,fontSize:18,readWidth:800,infiniteLoading:!1,customFontName:"",jumpDuration:1e3,spacing:{paragraph:1,line:.8,letter:0}},miniInterface:!1,readSettingsVisible:!1}),getters:{bookProgress:e=>{var l;if(e.catalog.length==0)return;const{index:a,chapterPos:t,bookName:o,bookAuthor:s}=e.readingBook;let n=(l=e.catalog[a])==null?void 0:l.title;if(n)return{name:o,author:s,durChapterIndex:a,durChapterPos:t,durChapterTime:new Date().getTime(),durChapterTitle:n}},theme:e=>e.config.theme},actions:{setConnectStatus(e){this.connectStatus=e},setConnectType(e){this.connectType=e},setNewConnect(e){this.newConnect=e},addBooks(e){this.shelf=e},clearBooks(){this.shelf=[]},setCatalog(e){this.catalog=e},setPopCataVisible(e){this.popCataVisible=e},setContentLoading(e){this.contentLoading=e},setReadingBook(e){this.readingBook=e},setConfig(e){this.config=Object.assign({},this.config,e)},setReadSettingsVisible(e){this.readSettingsVisible=e},setShowContent(e){this.showContent=e},setMiniInterface(e){this.miniInterface=e},async setSearchBooks(e){e.forEach(a=>{this.shelf.find(o=>o.bookUrl==a.bookUrl)===void 0&&this.searchBooks.push(a)})},clearSearchBooks(){this.searchBooks=[]},async saveBookProgress(){return this.bookProgress?B.saveBookProgress(this.bookProgress):Promise.resolve()}}});function P(e){return typeof e=="function"?e():w(e)}typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const M=()=>{};function T(e,a){function t(...o){return new Promise((s,n)=>{Promise.resolve(e(()=>a.apply(this,o),{fn:a,thisArg:this,args:o})).then(s).catch(n)})}return t}function Y(...e){let a=0,t,o=!0,s=M,n,l,i,r,c;!D(e[0])&&typeof e[0]=="object"?{delay:l,trailing:i=!0,leading:r=!0,rejectOnCancel:c=!1}=e[0]:[l,i=!0,r=!0,c=!1]=e;const p=()=>{t&&(clearTimeout(t),t=void 0,s(),s=M)};return h=>{const u=P(l),g=Date.now()-a,d=()=>n=h();return p(),u<=0?(a=Date.now(),d()):(g>u&&(r||!o)?(a=Date.now(),d()):i&&(n=new Promise((m,S)=>{s=c?S:m,t=setTimeout(()=>{a=Date.now(),o=!0,m(d()),p()},Math.max(0,u-g))})),!r&&!t&&(t=setTimeout(()=>o=!0,u)),o=!1,n)}}function E(e,a=200,t=!1,o=!0,s=!1){return T(Y(a,t,o,s),e)}const x=/[YMDHhms]o|\[([^\]]+)\]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a{1,2}|A{1,2}|m{1,2}|s{1,2}|Z{1,2}|SSS/g;function A(e,a,t,o){let s=e<12?"AM":"PM";return o&&(s=s.split("").reduce((n,l)=>n+=`${l}.`,"")),t?s.toLowerCase():s}function f(e){const a=["th","st","nd","rd"],t=e%100;return e+(a[(t-20)%10]||a[t]||a[0])}function V(e,a,t={}){var o;const s=e.getFullYear(),n=e.getMonth(),l=e.getDate(),i=e.getHours(),r=e.getMinutes(),c=e.getSeconds(),p=e.getMilliseconds(),k=e.getDay(),h=(o=t.customMeridiem)!=null?o:A,u={Yo:()=>f(s),YY:()=>String(s).slice(-2),YYYY:()=>s,M:()=>n+1,Mo:()=>f(n+1),MM:()=>`${n+1}`.padStart(2,"0"),MMM:()=>e.toLocaleDateString(t.locales,{month:"short"}),MMMM:()=>e.toLocaleDateString(t.locales,{month:"long"}),D:()=>String(l),Do:()=>f(l),DD:()=>`${l}`.padStart(2,"0"),H:()=>String(i),Ho:()=>f(i),HH:()=>`${i}`.padStart(2,"0"),h:()=>`${i%12||12}`.padStart(1,"0"),ho:()=>f(i%12||12),hh:()=>`${i%12||12}`.padStart(2,"0"),m:()=>String(r),mo:()=>f(r),mm:()=>`${r}`.padStart(2,"0"),s:()=>String(c),so:()=>f(c),ss:()=>`${c}`.padStart(2,"0"),SSS:()=>`${p}`.padStart(3,"0"),d:()=>k,dd:()=>e.toLocaleDateString(t.locales,{weekday:"narrow"}),ddd:()=>e.toLocaleDateString(t.locales,{weekday:"short"}),dddd:()=>e.toLocaleDateString(t.locales,{weekday:"long"}),A:()=>h(i,r),AA:()=>h(i,r,!1,!0),a:()=>h(i,r,!0),aa:()=>h(i,r,!0,!0)};return a.replace(x,(g,d)=>{var m,S;return(S=d??((m=u[g])==null?void 0:m.call(u)))!=null?S:g})}const R=e=>/,\s*\{/.test(e)||!(e.startsWith("http")||e.startsWith("data:")||e.startsWith("blob:")),j=e=>{let a=new Date().getTime(),t=Math.floor((a-e)/1e3),o="";return t<=30?o="刚刚":t<60?o=t+"秒前":t<3600?o=Math.floor(t/60)+"分钟前":t<86400?o=Math.floor(t/3600)+"小时前":t<2592e3?o=Math.floor(t/86400)+"天前":o=V(new Date(e),"YYYY-MM-DD"),o},H='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"/></svg>',I=(e,a,t=H)=>{const o=L(!1);let s=null;const n=()=>o.value=!1,l=()=>o.value=!0;C(o,r=>{if(!r)return s==null?void 0:s.close();s=v.service({target:w(e),spinner:t,text:a,lock:!0,background:"rgba(0, 0, 0, 0)"})});const i=r=>{if(!(r instanceof Promise))throw TypeError("loadingWrapper argument must be Promise");return l(),r.finally(n)};return y(()=>{n()}),{isLoading:o,showLoading:l,closeLoading:n,loadingWrapper:i}};export{I as a,E as b,j as d,R as i,F as u};
