import{a2 as $,n as V,o as i,d,g as e,F as J,P as D,t as u,c as G,w as P,f as L,M as y,u as s,a3 as W,p as O,i as Z,s as X,z as f,O as j,a4 as ee,T as te,k as S,e as x,A as se,L as ae,v as M,I as oe,B as ne}from"./vendor-e55ee8f4.js";import{d as ce,u as re}from"./loading-d74ae00f.js";import{_ as H,u as ie,A as T}from"./index-4abb2f36.js";const F=o=>(O("data-v-79a0da0d"),o=o(),Z(),o),le={class:"books-wrapper"},de={class:"wrapper"},ue=["onClick"],he={class:"cover-img"},pe=["src"],_e={class:"info"},ve={class:"name"},ge={class:"sub"},me={class:"author"},fe={key:0,class:"tags"},we={key:1,class:"update-info"},Ae=F(()=>e("div",{class:"dot"},"•",-1)),Ie={class:"size"},ke=F(()=>e("div",{class:"dot"},"•",-1)),Be={class:"date"},ye={key:0,class:"intro"},Se={key:1,class:"dur-chapter"},xe={class:"last-chapter"},Ce={__name:"BookItems",props:["books","isSearch"],emits:["bookClick"],setup(o,{emit:n}){$(l=>({d0aaf530:s(z)}));const C=o,R=n,E=l=>R("bookClick",l),w=l=>/^data:/.test(l)?l:location.origin+"/cover?path="+encodeURIComponent(l),z=V(()=>C.isSearch?"space-between":"flex-start");return(l,c)=>{const A=W;return i(),d("div",le,[e("div",de,[(i(!0),d(J,null,D(o.books,r=>{var I;return i(),d("div",{class:"book",key:r.bookUrl,onClick:m=>E(r)},[e("div",he,[(i(),d("img",{class:"cover",src:w(r.coverUrl),key:r.coverUrl,alt:"",loading:"lazy"},null,8,pe))]),e("div",_e,[e("div",ve,u(r.name),1),e("div",ge,[e("div",me,u(r.author),1),o.isSearch?(i(),d("div",fe,[(i(!0),d(J,null,D((I=r.kind)==null?void 0:I.split(",").slice(0,2),m=>(i(),G(A,{key:m},{default:P(()=>[L(u(m),1)]),_:2},1024))),128))])):y("",!0),o.isSearch?y("",!0):(i(),d("div",we,[Ae,e("div",Ie,"共"+u(r.totalChapterNum)+"章",1),ke,e("div",Be,u(s(ce)(r.lastCheckTime)),1)]))]),o.isSearch?(i(),d("div",ye,u(r.intro),1)):y("",!0),o.isSearch?y("",!0):(i(),d("div",Se," 已读："+u(r.durChapterTitle),1)),e("div",xe,"最新："+u(r.latestChapterTitle),1)])],8,ue)}),128))])])}}},Re=H(Ce,[["__scopeId","data-v-79a0da0d"]]);const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==";const N=o=>(O("data-v-6702555c"),o=o(),Z(),o),ze={class:"navigation-wrapper"},Me=N(()=>e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),Te={class:"search-wrapper"},Ve={class:"bottom-wrapper"},Pe={class:"recent-wrapper"},Le=N(()=>e("div",{class:"recent-title"},"最近阅读",-1)),Ne={class:"reading-recent"},be={class:"setting-wrapper"},Je=N(()=>e("div",{class:"setting-title"},"基本设定",-1)),De={class:"setting-item"},We={class:"bottom-icons"},Oe={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Ze={class:"bottom-icon"},He=["src"],Fe={__name:"BookShelf",setup(o){const n=ie(),{connectStatus:C,connectType:R,newConnect:E,shelf:w}=X(n),z=V(()=>n.config.theme),l=V(()=>z.value==6),c=f({name:"尚无阅读记录",author:"",url:"",chapterIndex:0,chapterPos:0}),A=f(null),{showLoading:r,closeLoading:I,loadingWrapper:m}=re(A,"正在获取书籍信息"),g=f([]),h=f(""),k=f(!1);j(()=>{if(!(k.value&&h.value!="")){if(k.value=!1,g.value=[],h.value==""){g.value=w.value;return}g.value=w.value.filter(t=>t.name.includes(h.value)||t.author.includes(h.value))}});const K=()=>{h.value!=""&&(g.value=[],n.clearSearchBooks(),r(),k.value=!0,T.search(h.value,t=>{try{n.setSearchBooks(JSON.parse(t)),n.searchBooks.forEach(a=>g.value.push(a))}catch(a){throw S.error("后端数据错误"),a}},()=>{I(),g.value.length==0&&S.info("搜索结果为空")}))},Y=()=>{},U=ee(),Q=async t=>{const{bookUrl:a,name:_,author:p,durChapterIndex:v=0,durChapterPos:B=0}=t;await T.saveBook(t),b(a,_,p,v,B)},b=(t,a,_,p,v)=>{a!=="尚无阅读记录"&&(sessionStorage.setItem("bookUrl",t),sessionStorage.setItem("bookName",a),sessionStorage.setItem("bookAuthor",_),sessionStorage.setItem("chapterIndex",p),sessionStorage.setItem("chapterPos",v),c.value={name:a,author:_,url:t,chapterIndex:p,chapterPos:v},localStorage.setItem("readingRecent",JSON.stringify(c.value)),U.push({path:"/chapter"}))};te(()=>{let t=localStorage.getItem("readingRecent");t!=null&&(c.value=JSON.parse(t),typeof c.value.chapterIndex>"u"&&(c.value.chapterIndex=0)),m(n.saveBookProgress().finally(q))});const q=()=>T.getBookShelf().then(t=>{n.setConnectType("success"),t.data.isSuccess?n.addBooks(t.data.data.sort(function(a,_){var p=a.durChapterTime||0,v=_.durChapterTime||0;return v-p})):S.error(t.data.errorMsg),n.setConnectStatus("已连接 "),n.setNewConnect(!1)}).catch(function(t){throw n.setConnectType("danger"),n.setConnectStatus("连接失败"),S.error("后端连接失败"),n.setNewConnect(!1),t});return(t,a)=>{const _=oe,p=W,v=Re;return i(),d("div",{class:M({"index-wrapper":!0,night:s(l),day:!s(l)})},[e("div",ze,[Me,e("div",Te,[x(_,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:s(h),"onUpdate:modelValue":a[0]||(a[0]=B=>se(h)?h.value=B:null),class:"search-input","prefix-icon":s(ne),onKeyup:ae(K,["enter"])},null,8,["modelValue","prefix-icon"])]),e("div",Ve,[e("div",Pe,[Le,e("div",Ne,[x(p,{type:s(c).name=="尚无阅读记录"?"warning":"",class:M(["recent-book",{"no-point":s(c).url==""}]),size:"large",onClick:a[1]||(a[1]=B=>b(s(c).url,s(c).name,s(c).author,s(c).chapterIndex,s(c).chapterPos))},{default:P(()=>[L(u(s(c).name),1)]),_:1},8,["type","class"])])]),e("div",be,[Je,e("div",De,[x(p,{type:s(R),size:"large",class:M(["setting-connect",{"no-point":s(E)}]),onClick:Y},{default:P(()=>[L(u(s(C)),1)]),_:1},8,["type","class"])])])]),e("div",We,[e("a",Oe,[e("div",Ze,[e("img",{src:s(Ee),alt:""},null,8,He)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:A},[x(v,{books:s(g),onBookClick:Q,isSearch:s(k)},null,8,["books","isSearch"])],512)],2)}}},Qe=H(Fe,[["__scopeId","data-v-6702555c"]]);export{Qe as default};
