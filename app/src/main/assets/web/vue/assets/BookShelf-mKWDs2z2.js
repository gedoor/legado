import{d as H,a4 as j,x as P,e as h,o as d,g as e,F as N,R as W,O as x,A as p,c as $,w as V,h as M,a5 as J,u as o,D as I,s as ee,Q as te,a6 as se,a7 as oe,U as ae,f as C,P as ne,H as re,I as ie,G as le,z as b,n as z,a8 as ce}from"./vendor-CfPT2q4_.js";import{d as de,A as B,i as ue,_ as O,u as he,a as pe,v as ge,l as ve,s as me,p as fe,b as D}from"./index-D_XjpHvF.js";import{u as _e}from"./loading-DXdcplx0.js";const we={class:"books-wrapper"},Be={class:"wrapper"},ke=["onClick"],Ae={class:"cover-img"},ye=["src"],Se={class:"info"},xe={class:"name"},Ie={class:"sub"},Ce={class:"author"},Re={key:0,class:"tags"},Ee={key:1,class:"update-info"},Le={class:"size"},be={class:"date"},ze={key:0,class:"intro"},Pe={key:1,class:"dur-chapter"},Ve={class:"last-chapter"},Me=H({__name:"BookItems",props:{books:{},isSearch:{type:Boolean}},emits:["bookClick"],setup(_,{emit:i}){j(g=>({v2a51eeb0:o(y)}));const k=_,R=i,a=g=>R("bookClick",g),A=({bookUrl:g,coverUrl:r})=>r===void 0?B.getProxyCoverUrl(g):ue(r)?B.getProxyCoverUrl(r):r,E=g=>{const r=g.target;r.src=B.getProxyCoverUrl(r.src)},y=P(()=>k.isSearch?"space-between":"flex-start");return(g,r)=>{const v=J;return d(),h("div",we,[e("div",Be,[(d(!0),h(N,null,W(_.books,n=>{var l;return d(),h("div",{class:"book",key:n.bookUrl,onClick:f=>a(n)},[e("div",Ae,[(d(),h("img",{class:"cover",src:A(n),key:n.coverUrl,onErrorOnce:E,alt:"",loading:"lazy"},null,40,ye))]),e("div",Se,[e("div",xe,p(n.name),1),e("div",Ie,[e("div",Ce,p(n.author),1),_.isSearch?(d(),h("div",Re,[(d(!0),h(N,null,W((l=n.kind)==null?void 0:l.split(",").slice(0,2),f=>(d(),$(v,{key:f},{default:V(()=>[M(p(f),1)]),_:2},1024))),128))])):x("",!0),_.isSearch?x("",!0):(d(),h("div",Ee,[r[0]||(r[0]=e("div",{class:"dot"},"•",-1)),e("div",Le,"共"+p(n.totalChapterNum)+"章",1),r[1]||(r[1]=e("div",{class:"dot"},"•",-1)),e("div",be,p(o(de)(n.lastCheckTime)),1)]))]),_.isSearch?(d(),h("div",ze,p(n.intro),1)):x("",!0),_.isSearch?x("",!0):(d(),h("div",Pe," 已读："+p(n.durChapterTitle),1)),e("div",Ve,"最新："+p(n.latestChapterTitle),1)])],8,ke)}),128))])])}}}),Te=O(Me,[["__scopeId","data-v-0f5f0160"]]),Ue="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Ne={class:"navigation-wrapper"},We={class:"search-wrapper"},De={class:"bottom-wrapper"},He={class:"recent-wrapper"},Je={class:"reading-recent"},Oe={class:"setting-wrapper"},Ze={class:"setting-item"},Fe={class:"bottom-icons"},Ke={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Ye={class:"bottom-icon"},Qe=["src"],qe=H({__name:"BookShelf",setup(_){const i=he(),k=P(()=>i.isNight),R=s=>{try{s!==void 0&&i.setConfig(s)}catch{z.info("阅读界面配置解析错误")}},a=I({name:"尚无阅读记录",author:"",bookUrl:"",chapterIndex:0,chapterPos:0,isSeachBook:!1}),A=I(),{showLoading:E,closeLoading:y,loadingWrapper:g,isLoading:r}=_e(A,"正在获取书籍信息"),v=ee([]),n=P(()=>i.shelf),l=I(""),f=I(!1);te(()=>{if(!(f.value&&l.value!="")){if(f.value=!1,v.value=[],l.value==""){v.value=n.value;return}v.value=n.value.filter(s=>s.name.includes(l.value)||s.author.includes(l.value))}});const T=()=>{l.value!=""&&(v.value=[],i.clearSearchBooks(),E(),f.value=!0,B.search(l.value,s=>{r&&y();try{i.setSearchBooks(s),v.value=i.searchBooks}catch(t){throw z.error("后端数据错误"),t}},()=>{y(),v.value.length==0&&z.info("搜索结果为空")}))},S=pe(),{connectStatus:Z,connectType:F,newConnect:K}=se(S),Y=()=>{ce.prompt("请输入 后端地址 ( 如：http://127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:ve,inputValidator:s=>ge(s),inputErrorMessage:"输入的格式不对",beforeClose:(s,t,m)=>{if(s==="confirm"){S.setNewConnect(!0),t.confirmButtonLoading=!0,t.confirmButtonText="校验中……";const c=new URL(t.inputValue).toString();B.getReadConfig(c).then(function(u){S.setNewConnect(!1),R(u),t.confirmButtonLoading=!1,i.clearSearchBooks(),me(...fe(c)),c===location.origin?localStorage.removeItem(D):localStorage.setItem(D,c),i.loadBookShelf(),m()}).catch(function(u){throw S.setNewConnect(!1),t.confirmButtonLoading=!1,t.confirmButtonText="确定",u})}else m()}})},Q=oe(),q=async s=>{const t="respondTime"in s;t&&await B.saveBook(s);const{bookUrl:m,name:c,author:u,durChapterIndex:w=0,durChapterPos:L=0}=s;U(m,c,u,w,L,t)},U=(s,t,m,c,u,w=!1,L=!1)=>{if(t!=="尚无阅读记录"){if(L&&n.value.every(X=>X.bookUrl!==s)){l.value=t,T();return}sessionStorage.setItem("bookUrl",s),sessionStorage.setItem("bookName",t),sessionStorage.setItem("bookAuthor",m),sessionStorage.setItem("chapterIndex",String(c)),sessionStorage.setItem("chapterPos",String(u)),sessionStorage.setItem("isSeachBook",String(w)),a.value={name:t,author:m,bookUrl:s,chapterIndex:c,chapterPos:u,isSeachBook:w},localStorage.setItem("readingRecent",JSON.stringify(a.value)),Q.push({path:"/chapter"})}},G=async()=>{await i.loadWebConfig(),await i.saveBookProgress(),await i.loadBookShelf()};return ae(()=>{const s=localStorage.getItem("readingRecent");s!=null&&(a.value=JSON.parse(s),typeof a.value.chapterIndex>"u"&&(a.value.chapterIndex=0)),g(G())}),(s,t)=>{const m=le,c=J,u=Te;return d(),h("div",{class:b({"index-wrapper":!0,night:o(k),day:!o(k)})},[e("div",Ne,[t[4]||(t[4]=e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),e("div",We,[C(m,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:o(l),"onUpdate:modelValue":t[0]||(t[0]=w=>ie(l)?l.value=w:null),class:"search-input","prefix-icon":o(re),onKeyup:ne(T,["enter"])},null,8,["modelValue","prefix-icon"])]),e("div",De,[e("div",He,[t[2]||(t[2]=e("div",{class:"recent-title"},"最近阅读",-1)),e("div",Je,[C(c,{type:o(a).name=="尚无阅读记录"?"warning":"primary",class:b(["recent-book",{"no-point":o(a).bookUrl==""}]),size:"large",onClick:t[1]||(t[1]=w=>U(o(a).bookUrl,o(a).name,o(a).author,o(a).chapterIndex,o(a).chapterPos,o(a).isSeachBook,!0))},{default:V(()=>[M(p(o(a).name),1)]),_:1},8,["type","class"])])]),e("div",Oe,[t[3]||(t[3]=e("div",{class:"setting-title"},"基本设定",-1)),e("div",Ze,[C(c,{type:o(F),size:"large",class:b(["setting-connect",{"no-point":o(K)}]),onClick:Y},{default:V(()=>[M(p(o(Z)),1)]),_:1},8,["type","class"])])])]),e("div",Fe,[e("a",Ke,[e("div",Ye,[e("img",{src:o(Ue),alt:""},null,8,Qe)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:A},[C(u,{books:o(v),onBookClick:q,isSearch:o(f)},null,8,["books","isSearch"])],512)],2)}}}),$e=O(qe,[["__scopeId","data-v-5061e9c0"]]);export{$e as default};
