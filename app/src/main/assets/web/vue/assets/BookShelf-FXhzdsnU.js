import{d as J,a2 as $,p as w,o as u,e as h,h as e,F as U,O as W,t as g,c as ee,w as b,g as z,L as A,u as a,a3 as O,y as C,a4 as te,N as se,a5 as oe,S as ae,f as I,z as ne,K as re,s as T,a6 as ie,m as x,H as ce,A as le}from"./vendor-DyE_jpJ0.js";import{d as de,A as y,i as ue,_ as Z,u as pe,l as D,v as he,s as ge,p as me,b as H}from"./index-ecLu3hyj.js";import{u as fe}from"./loading-DO4FBnCG.js";const ve={class:"books-wrapper"},_e={class:"wrapper"},we=["onClick"],ye={class:"cover-img"},Be=["src"],Se={class:"info"},ke={class:"name"},Ae={class:"sub"},Ce={class:"author"},Ie={key:0,class:"tags"},xe={key:1,class:"update-info"},Re={class:"size"},Ee={class:"date"},Le={key:0,class:"intro"},Te={key:1,class:"dur-chapter"},be={class:"last-chapter"},ze=J({__name:"BookItems",props:{books:{},isSearch:{type:Boolean}},emits:["bookClick"],setup(V,{emit:s}){$(i=>({"2a51eeb0":a(k)}));const B=V,R=s,n=i=>R("bookClick",i),S=({bookUrl:i,coverUrl:c})=>c===void 0?y.getProxyCoverUrl(i):ue(c)?y.getProxyCoverUrl(c):c,E=i=>{const c=i.target;c.src=y.getProxyCoverUrl(c.src)},k=w(()=>B.isSearch?"space-between":"flex-start");return(i,c)=>{const m=O;return u(),h("div",ve,[e("div",_e,[(u(!0),h(U,null,W(i.books,r=>{var l;return u(),h("div",{class:"book",key:r.bookUrl,onClick:v=>n(r)},[e("div",ye,[(u(),h("img",{class:"cover",src:S(r),key:r.coverUrl,onErrorOnce:E,alt:"",loading:"lazy"},null,40,Be))]),e("div",Se,[e("div",ke,g(r.name),1),e("div",Ae,[e("div",Ce,g(r.author),1),i.isSearch?(u(),h("div",Ie,[(u(!0),h(U,null,W((l=r.kind)==null?void 0:l.split(",").slice(0,2),v=>(u(),ee(m,{key:v},{default:b(()=>[z(g(v),1)]),_:2},1024))),128))])):A("",!0),i.isSearch?A("",!0):(u(),h("div",xe,[c[0]||(c[0]=e("div",{class:"dot"},"•",-1)),e("div",Re,"共"+g(r.totalChapterNum)+"章",1),c[1]||(c[1]=e("div",{class:"dot"},"•",-1)),e("div",Ee,g(a(de)(r.lastCheckTime)),1)]))]),i.isSearch?(u(),h("div",Le,g(r.intro),1)):A("",!0),i.isSearch?A("",!0):(u(),h("div",Te," 已读："+g(r.durChapterTitle),1)),e("div",be,"最新："+g(r.latestChapterTitle),1)])],8,we)}),128))])])}}}),Ve=Z(ze,[["__scopeId","data-v-0f5f0160"]]),Me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAECUlEQVRYR7WXTYhcRRDHq3pY9yKrYBQ8KBsjgvHgwRhiQBTjYZm4Xe8NusawhwS/o9GLoKhgBGPAgJd1NdGIXwtZTbRf9Rqzl6gHTVyDeIkIgnEOghAM6oKHzTJd0sO8Zaa338zb7NjwmJn++Ndv+lVVVyOsoM3Ozl69sLBAiHiDc26NUuoKv9w5d14p9aeI/DI4OMgjIyN/lJXFMhOttQ8BgBaR0TLzEXEGAKzW+lCv+V0BmLmGiLtF5M5eQrFxRPxaRCaI6LOi9YUAzPwGADxxMYYjayaJ6MkoZKyTmU8AwF19Mp7LfElEW0LNZTvAzIcBYFufjedy00T0QLt2B4AxZo9S6qX/yXhT1jn3cpqme3IbSwDM/DgAvNlu3Dm3Uyl1HAA2IOJ2EdleEu5Io9H4EBHPVCqVLSISRsMuInrLazUBpqamhoaGhr4TkRsDgLVpmtbzPmPMLQBwOwD4vvzxw8P5IyJztVrtVL4my7L1iPhTx7Yj/jw/P79pfHx8vgmQZdkLiPhK+O8GBgauqVarv5f819FpxpjLlVJ/hYMi8mKSJHubAMz8KwBcF1EYI6IjqwRIlFImonGWiNZhlmVVRDxWYGTVAMx8HwB8EtMXka1orT0gIo9GJrxNRLH+FW8IMx8EgEeW5QDEgx5gTkQ2Bk7yr9b60hVb6rKAmc8BwJWBne+x4P3XiWhtPwGstV9FzpSzHuBvALgsMHaaiDp2ZbUwWZZNIuKuQOcfD7AAAJeEcaq1Xr9ao+3rmdknnscCzQse4LdWEukYazQaa2q12vl+QTDztwCwOdCr+zA8iYi3RQwREdl+ADDz9QDwIwB0OLaInPJRcEhEHoyEyAmt9d39ALDW2lg1hYjv+lfgC4WJgkTxcJIkPcuqbpC+qgKATwvm7PYAGwDgdBeRZ4notYvZCWPMDqXUe13W3to8C6y10yJyv//u6zj/2R6ziPiRiBwt6xPMrBExFZEdRcYR8WOt9bb8MNoKAJ+3Jvtwed05d4dSKtz+c4h4VGsdrRWttZMici8AXFVix+4homNLBUmWZQcQMc/9x4mommXZ84i4t11MKbV5dHR06bxvH5uZmbnZOfdN6O0RmMNE1CxulgCstdeKyBcAcFPrVTyltZ4wxiSVSuXplkhda72zh9P1rClFZFOSJHMdAP5Hq3rxR6eH+IGIvIOuqFlr94nIc10WdRzxy6riAMJnr2nn3JlcME3TppMWNWvtfhF5pmB8WX0RvZgEEEtaYUUbM2KtfUdE/FUubNHipvBmZIxZp5TaDwBprlQGIHLqzSHiPq01x4B7Xk6Z2d8TfDwPlwFozfd1f90598Hi4uKrY2NjFwrzQVkP81nNi/byAWOMv8gOp2n6fhnt/wDqJrRWLmhIrwAAAABJRU5ErkJggg==",Pe={class:"navigation-wrapper"},Ne={class:"search-wrapper"},Ue={class:"bottom-wrapper"},We={class:"recent-wrapper"},De={class:"reading-recent"},He={class:"setting-wrapper"},Je={class:"setting-item"},Oe={class:"bottom-icons"},Ze={href:"https://github.com/gedoor/legado_web_bookshelf",target:"_blank"},Fe={class:"bottom-icon"},Ke=["src"],Ye=J({__name:"BookShelf",setup(V){const s=pe(),B=w(()=>s.isNight),R=o=>{try{o!==void 0&&s.setConfig(o)}catch{x.info("阅读界面配置解析错误")}},n=C({name:"尚无阅读记录",author:"",bookUrl:"",chapterIndex:0,chapterPos:0,isSeachBook:!1}),S=C(),{showLoading:E,closeLoading:k,loadingWrapper:i,isLoading:c}=fe(S,"正在获取书籍信息"),m=te([]),r=w(()=>s.shelf),l=C(""),v=C(!1);se(()=>{if(!(v.value&&l.value!="")){if(v.value=!1,m.value=[],l.value==""){m.value=r.value;return}m.value=r.value.filter(o=>o.name.includes(l.value)||o.author.includes(l.value))}});const M=()=>{l.value!=""&&(m.value=[],s.clearSearchBooks(),E(),v.value=!0,y.search(l.value,o=>{c&&k();try{s.setSearchBooks(o),m.value=s.searchBooks}catch(t){throw x.error("后端数据错误"),t}},()=>{k(),m.value.length==0&&x.info("搜索结果为空")}))},F=w(()=>s.connectStatus),K=w(()=>s.connectType),Y=w(()=>s.newConnect),Q=()=>{ie.prompt("请输入 后端地址 ( 如：http://127.0.0.1:9527 或者通过内网穿透的地址)","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPlaceholder:D,inputValidator:o=>he(o),inputErrorMessage:"输入的格式不对",beforeClose:(o,t,f)=>{if(o==="confirm"){s.setNewConnect(!0),t.confirmButtonLoading=!0,t.confirmButtonText="校验中……";const d=new URL(t.inputValue).toString();y.getReadConfig(d).then(function(p){R(p),t.confirmButtonLoading=!1,s.setConnectType("success"),s.clearSearchBooks(),s.setNewConnect(!1),ge(...me(d)),d===location.origin?localStorage.removeItem(H):localStorage.setItem(H,d),s.setConnectStatus("已连接 "+d.toString()),N(),f()}).catch(function(p){throw t.confirmButtonLoading=!1,t.confirmButtonText="确定",x.error("访问失败，请检查您输入的 url"),s.setNewConnect(!1),p})}else f()}})},q=oe(),G=async o=>{const t="respondTime"in o;t&&await y.saveBook(o);const{bookUrl:f,name:d,author:p,durChapterIndex:_=0,durChapterPos:L=0}=o;P(f,d,p,_,L,t)},P=(o,t,f,d,p,_=!1,L=!1)=>{if(t!=="尚无阅读记录"){if(L&&r.value.every(j=>j.bookUrl!==o)){l.value=t,M();return}sessionStorage.setItem("bookUrl",o),sessionStorage.setItem("bookName",t),sessionStorage.setItem("bookAuthor",f),sessionStorage.setItem("chapterIndex",String(d)),sessionStorage.setItem("chapterPos",String(p)),sessionStorage.setItem("isSeachBook",String(_)),n.value={name:t,author:f,bookUrl:o,chapterIndex:d,chapterPos:p,isSeachBook:_},localStorage.setItem("readingRecent",JSON.stringify(n.value)),q.push({path:"/chapter"})}},X=async()=>{try{await s.loadWebConfig(),await s.saveBookProgress(),await N()}catch(o){throw s.setConnectType("danger"),s.setConnectStatus("连接异常"),s.setNewConnect(!1),o}},N=async()=>{await s.loadBookShelf(),s.setConnectType("primary"),s.setConnectStatus("已连接 "+D),s.setNewConnect(!1)};return ae(()=>{const o=localStorage.getItem("readingRecent");o!=null&&(n.value=JSON.parse(o),typeof n.value.chapterIndex>"u"&&(n.value.chapterIndex=0)),i(X())}),(o,t)=>{const f=ce,d=O,p=Ve;return u(),h("div",{class:T({"index-wrapper":!0,night:a(B),day:!a(B)})},[e("div",Pe,[t[4]||(t[4]=e("div",{class:"navigation-title-wrapper"},[e("div",{class:"navigation-title"},"阅读"),e("div",{class:"navigation-sub-title"},"清风不识字，何故乱翻书")],-1)),e("div",Ne,[I(f,{placeholder:"搜索书籍，在线书籍自动加入书架",modelValue:a(l),"onUpdate:modelValue":t[0]||(t[0]=_=>ne(l)?l.value=_:null),class:"search-input","prefix-icon":a(le),onKeyup:re(M,["enter"])},null,8,["modelValue","prefix-icon"])]),e("div",Ue,[e("div",We,[t[2]||(t[2]=e("div",{class:"recent-title"},"最近阅读",-1)),e("div",De,[I(d,{type:a(n).name=="尚无阅读记录"?"warning":"primary",class:T(["recent-book",{"no-point":a(n).bookUrl==""}]),size:"large",onClick:t[1]||(t[1]=_=>P(a(n).bookUrl,a(n).name,a(n).author,a(n).chapterIndex,a(n).chapterPos,a(n).isSeachBook,!0))},{default:b(()=>[z(g(a(n).name),1)]),_:1},8,["type","class"])])]),e("div",He,[t[3]||(t[3]=e("div",{class:"setting-title"},"基本设定",-1)),e("div",Je,[I(d,{type:a(K),size:"large",class:T(["setting-connect",{"no-point":a(Y)}]),onClick:Q},{default:b(()=>[z(g(a(F)),1)]),_:1},8,["type","class"])])])]),e("div",Oe,[e("a",Ze,[e("div",Fe,[e("img",{src:a(Me),alt:""},null,8,Ke)])])])]),e("div",{class:"shelf-wrapper",ref_key:"shelfWrapper",ref:S},[I(p,{books:a(m),onBookClick:G,isSearch:a(v)},null,8,["books","isSearch"])],512)],2)}}}),Xe=Z(Ye,[["__scopeId","data-v-ea3fcb53"]]);export{Xe as default};
